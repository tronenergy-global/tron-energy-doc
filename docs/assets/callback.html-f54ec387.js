import{_ as i,r as o,o as u,c as k,b as n,d as s,e as a,w as t,a as r}from"./app-5b967fec.js";const d={},m=n("h1",{id:"回调",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#回调","aria-hidden":"true"},"#"),s(" 回调")],-1),b=n("p",null,"当前委托能量完成后，会尝试发送消息通知发起方，当前有两个地方可以设置回调地址",-1),v={href:"https://%7Bdomain%7D/buyer/me",target:"_blank",rel:"noopener noreferrer"},g=n("li",null,"2，在下单的时候指定callback_url参数覆盖默认回调地址",-1),h=r(`<div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>data = <span class="token punctuation">{</span>
   &#39;energy_amount&#39;<span class="token operator">:</span> &#39;<span class="token number">32000</span>&#39;<span class="token punctuation">,</span>
   &#39;period&#39;<span class="token operator">:</span> &#39;1H&#39;<span class="token punctuation">,</span>
   &#39;receive_address&#39;<span class="token operator">:</span> &#39;TExWKszFWYTKZH8LYiovAPKzS3L9MLZ4kw&#39;<span class="token punctuation">,</span>
   &#39;callback_url&#39;<span class="token operator">:</span> &#39;http<span class="token operator">:</span><span class="token comment">//{mydomain}/callback&#39;,</span>
   &#39;out_trade_no&#39;<span class="token operator">:</span> &#39;<span class="token number">123456</span>&#39;<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="响应-重试" tabindex="-1"><a class="header-anchor" href="#响应-重试" aria-hidden="true">#</a> 响应&amp;重试</h2><p>响应body如下</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    &#39;active_hash&#39;<span class="token operator">:</span> &#39;&#39;<span class="token punctuation">,</span>  <span class="token comment">// 如果有激活，激活的txid</span>
    &#39;bandwidth_hash&#39;<span class="token operator">:</span> &#39;5e342a821de72542d7b341039c34af631d0551cfcd4b67c272&#39;<span class="token punctuation">,</span> <span class="token comment">// 如果有带宽，带宽的txid</span>
    &#39;energy_amount&#39;<span class="token operator">:</span> <span class="token number">32000</span><span class="token punctuation">,</span> <span class="token comment">// 下单能量</span>
    &#39;out_trade_no&#39;<span class="token operator">:</span> &#39;<span class="token number">123456</span>&#39;<span class="token punctuation">,</span>  <span class="token comment">// 外部订单号</span>
    &#39;pay_amount&#39;<span class="token operator">:</span> <span class="token number">32170.005048646104</span><span class="token punctuation">,</span>  <span class="token comment">// 实际委托能量</span>
    &#39;serial&#39;<span class="token operator">:</span> &#39;886294f5204ac2fc1430f5a7d9215a80&#39;<span class="token punctuation">,</span> <span class="token comment">// 内部订单号</span>
    &#39;txid&#39;<span class="token operator">:</span> &#39;2610c200efc8a90601758715405fa6be4597469e854591975d113b720a762ec2&#39;<span class="token punctuation">,</span> <span class="token comment">// 能量的txid</span>
    &#39;status&#39;<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>  <span class="token comment">// 状态 40成功，41失败</span>
    &#39;type&#39;<span class="token operator">:</span> &#39;energy&#39;<span class="token punctuation">,</span> <span class="token comment">// 类型</span>
    &#39;receive_address&#39;<span class="token operator">:</span> &#39;Txxxxxx&#39;<span class="token punctuation">,</span> <span class="token comment">// 地址</span>
    &#39;source&#39;<span class="token operator">:</span> &#39;manual/api/auto_delegate/count_delegate&#39;<span class="token punctuation">,</span> <span class="token comment">// 手动下单/API下单/智能委托/笔数委托</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您接受到了回调信息，只需要返回<code>HTTP 200</code>，即表示消息已处理，本条回调不再会发送，否则会尝试重复发送直到获得期望的响应， 目前的重试频率为<code>15s, 15s, 30s, 180s, 600s, 1200s, 1800s</code>，都无响应后，不再重复发送。</p><h2 id="校验" tabindex="-1"><a class="header-anchor" href="#校验" aria-hidden="true">#</a> 校验</h2>`,6),y=n("code",null,"SIGNATURE",-1),_=n("h2",{id:"代码示例",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#代码示例","aria-hidden":"true"},"#"),s(" 代码示例")],-1),f=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` hmac
`),n("span",{class:"token keyword"},"import"),s(` hashlib
`),n("span",{class:"token keyword"},"import"),s(` time
`),n("span",{class:"token keyword"},"import"),s(` json

`),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"callback"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},","),s(" request"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
   `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"_verify_signature"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},","),s(" timestamp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
       api_secret `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'0285A2741D0E76E2E187260EB23E51851D48403A756333E7D0CF845406ABF3E8'"),s(`
       json_data `),n("span",{class:"token operator"},"="),s(" json"),n("span",{class:"token punctuation"},"."),s("dumps"),n("span",{class:"token punctuation"},"("),s("request"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},","),s(" sort_keys"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`


       message `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string-interpolation"},[n("span",{class:"token string"},'f"'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("timestamp"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},"&"),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),s("json_data"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),s(`
       expected_signature `),n("span",{class:"token operator"},"="),s(" hmac"),n("span",{class:"token punctuation"},"."),s("new"),n("span",{class:"token punctuation"},"("),s("api_secret"),n("span",{class:"token punctuation"},"."),s("encode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" message"),n("span",{class:"token punctuation"},"."),s("encode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" hashlib"),n("span",{class:"token punctuation"},"."),s("sha256"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("hexdigest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`


       `),n("span",{class:"token keyword"},"return"),s(" hmac"),n("span",{class:"token punctuation"},"."),s("compare_digest"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},","),s(" expected_signature"),n("span",{class:"token punctuation"},")"),s(`


   signature `),n("span",{class:"token operator"},"="),s(" request"),n("span",{class:"token punctuation"},"."),s("META"),n("span",{class:"token punctuation"},"."),s("get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'HTTP_SIGNATURE'"),n("span",{class:"token punctuation"},")"),s(`
   timestamp `),n("span",{class:"token operator"},"="),s(" request"),n("span",{class:"token punctuation"},"."),s("META"),n("span",{class:"token punctuation"},"."),s("get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'HTTP_TIMESTAMP'"),n("span",{class:"token punctuation"},")"),s(`


   `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token keyword"},"not"),s(),n("span",{class:"token builtin"},"all"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),s("signature"),n("span",{class:"token punctuation"},","),s(" timestamp"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"None"),s(`


   `),n("span",{class:"token keyword"},"if"),s(" time"),n("span",{class:"token punctuation"},"."),s("time"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token builtin"},"float"),n("span",{class:"token punctuation"},"("),s("timestamp"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},">"),s(),n("span",{class:"token number"},"100"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token comment"},"# 视情况，是否要继续处理"),s(`
       `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'timestamp expired'"),n("span",{class:"token punctuation"},")"),s(`


   `),n("span",{class:"token keyword"},"if"),s(" _verify_signature"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},","),s(" timestamp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("request"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},")"),s(`
   `),n("span",{class:"token keyword"},"else"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'verify signature failed'"),n("span",{class:"token punctuation"},")"),s(`


   `),n("span",{class:"token keyword"},"return"),s(" Response"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("div",{class:"language-php line-numbers-mode","data-ext":"php"},[n("pre",{class:"language-php"},[n("code",null,[n("span",{class:"token php language-php"},[n("span",{class:"token delimiter important"},"<?php"),s(`
`),n("span",{class:"token variable"},"$api_secret"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string double-quoted-string"},'"0285A2741D0E76E2E187260EB23E51851D48403A756333E7D0CF845406ABF3E8"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token variable"},"$headers"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// your headers here"),s(`
`),n("span",{class:"token variable"},"$body"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// your body data here"),s(`

`),n("span",{class:"token variable"},"$timestamp"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token variable"},"$headers"),n("span",{class:"token punctuation"},"["),n("span",{class:"token string single-quoted-string"},"'TIMESTAMP'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token variable"},"$signature"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token variable"},"$headers"),n("span",{class:"token punctuation"},"["),n("span",{class:"token string single-quoted-string"},"'SIGNATURE'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"ksort"),n("span",{class:"token punctuation"},"("),n("span",{class:"token variable"},"$body"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token variable"},"$json_data"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"json_encode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token variable"},"$body"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"JSON_UNESCAPED_SLASHES"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token variable"},"$message"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token variable"},"$timestamp"),s(),n("span",{class:"token operator"},"."),s(),n("span",{class:"token string single-quoted-string"},"'&'"),s(),n("span",{class:"token operator"},"."),s(),n("span",{class:"token variable"},"$json_data"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token variable"},"$expected_signature"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"hash_hmac"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string single-quoted-string"},"'sha256'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token variable"},"$message"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token variable"},"$api_secret"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"hash_equals"),n("span",{class:"token punctuation"},"("),n("span",{class:"token variable"},"$signature"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token variable"},"$expected_signature"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"echo"),s(),n("span",{class:"token string double-quoted-string"},'"Signature is valid.\\n"'),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token function"},"print_r"),n("span",{class:"token punctuation"},"("),n("span",{class:"token variable"},"$body"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"echo"),s(),n("span",{class:"token string double-quoted-string"},'"Signature is invalid.\\n"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("commons"),n("span",{class:"token punctuation"},"."),s("codec"),n("span",{class:"token punctuation"},"."),s("digest"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"HmacAlgorithms")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("commons"),n("span",{class:"token punctuation"},"."),s("codec"),n("span",{class:"token punctuation"},"."),s("digest"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"HmacUtils")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("apache"),n("span",{class:"token punctuation"},"."),s("commons"),n("span",{class:"token punctuation"},"."),s("lang3"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"StringUtils")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("google"),n("span",{class:"token punctuation"},"."),s("gson"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Gson")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("google"),n("span",{class:"token punctuation"},"."),s("gson"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"GsonBuilder")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token operator"},"*")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Main"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" apiSecret "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"0285A2741D0E76E2E187260EB23E51851D48403A756333E7D0CF845406ABF3E8"'),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"Map"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},">")]),s(" headers "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"HashMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// your headers here"),s(`
        `),n("span",{class:"token class-name"},"Map"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),n("span",{class:"token punctuation"},">")]),s(" body "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"HashMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// your body data here"),s(`

        `),n("span",{class:"token class-name"},"String"),s(" timestamp "),n("span",{class:"token operator"},"="),s(" headers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"TIMESTAMP"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" signature "),n("span",{class:"token operator"},"="),s(" headers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGNATURE"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token class-name"},"Gson"),s(" gson "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"GsonBuilder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"disableHtmlEscaping"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"create"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token class-name"},"TreeMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),n("span",{class:"token punctuation"},">")]),s(" sortedBody "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TreeMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" jsonData "),n("span",{class:"token operator"},"="),s(" gson"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJson"),n("span",{class:"token punctuation"},"("),s("sortedBody"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token class-name"},"String"),s(" message "),n("span",{class:"token operator"},"="),s(" timestamp "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"&"'),s(),n("span",{class:"token operator"},"+"),s(" jsonData"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" expectedSignature "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"HmacUtils"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"HmacAlgorithms"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"HMAC_SHA_256"),n("span",{class:"token punctuation"},","),s(" apiSecret"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"hmacHex"),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StringUtils"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"equals"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},","),s(" expectedSignature"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Signature is valid."'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Signature is invalid."'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-go line-numbers-mode","data-ext":"go"},[n("pre",{class:"language-go"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(` main

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token string"},'"crypto/hmac"'),s(`
    `),n("span",{class:"token string"},'"crypto/sha256"'),s(`
    `),n("span",{class:"token string"},'"encoding/hex"'),s(`
    `),n("span",{class:"token string"},'"encoding/json"'),s(`
    `),n("span",{class:"token string"},'"fmt"'),s(`
    `),n("span",{class:"token string"},'"sort"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"type"),s(" Body "),n("span",{class:"token keyword"},"map"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token keyword"},"interface"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token punctuation"},"("),s("b Body"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token function"},"MarshalJSON"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"byte"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token builtin"},"error"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    keys `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token function"},"make"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),s("b"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"for"),s(" k "),n("span",{class:"token operator"},":="),s(),n("span",{class:"token keyword"},"range"),s(" b "),n("span",{class:"token punctuation"},"{"),s(`
        keys `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"append"),n("span",{class:"token punctuation"},"("),s("keys"),n("span",{class:"token punctuation"},","),s(" k"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    sort`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Strings"),n("span",{class:"token punctuation"},"("),s("keys"),n("span",{class:"token punctuation"},")"),s(`

    result `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token string"},'"{"'),s(`
    `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token boolean"},"_"),n("span",{class:"token punctuation"},","),s(" k "),n("span",{class:"token operator"},":="),s(),n("span",{class:"token keyword"},"range"),s(" keys "),n("span",{class:"token punctuation"},"{"),s(`
        value`),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"_"),s(),n("span",{class:"token operator"},":="),s(" json"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Marshal"),n("span",{class:"token punctuation"},"("),s("b"),n("span",{class:"token punctuation"},"["),s("k"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
        result `),n("span",{class:"token operator"},"+="),s(" fmt"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sprintf"),n("span",{class:"token punctuation"},"("),s("`"),n("span",{class:"token string"},'"%s"'),n("span",{class:"token punctuation"},":"),n("span",{class:"token operator"},"%"),s("s"),n("span",{class:"token punctuation"},","),s("`"),n("span",{class:"token punctuation"},","),s(" k"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    result `),n("span",{class:"token operator"},"="),s(" result"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},":"),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),s("result"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"}"'),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token function"},"byte"),n("span",{class:"token punctuation"},"("),s("result"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"nil"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"func"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    apiSecret `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token string"},'"0285A2741D0E76E2E187260EB23E51851D48403A756333E7D0CF845406ABF3E8"'),s(`
    headers `),n("span",{class:"token operator"},":="),s(),n("span",{class:"token keyword"},"map"),n("span",{class:"token punctuation"},"["),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token comment"},"// your headers here"),s(`
    body `),n("span",{class:"token operator"},":="),s(" Body"),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token comment"},"// your body data here"),s(`

    timestamp `),n("span",{class:"token operator"},":="),s(" headers"),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},'"TIMESTAMP"'),n("span",{class:"token punctuation"},"]"),s(`
    signature `),n("span",{class:"token operator"},":="),s(" headers"),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},'"SIGNATURE"'),n("span",{class:"token punctuation"},"]"),s(`

    jsonData`),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"_"),s(),n("span",{class:"token operator"},":="),s(" json"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Marshal"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},")"),s(`
    message `),n("span",{class:"token operator"},":="),s(" timestamp "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"&"'),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token function"},"string"),n("span",{class:"token punctuation"},"("),s("jsonData"),n("span",{class:"token punctuation"},")"),s(`

    mac `),n("span",{class:"token operator"},":="),s(" hmac"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"New"),n("span",{class:"token punctuation"},"("),s("sha256"),n("span",{class:"token punctuation"},"."),s("New"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token function"},"byte"),n("span",{class:"token punctuation"},"("),s("apiSecret"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    mac`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token function"},"byte"),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    expectedSignature `),n("span",{class:"token operator"},":="),s(" hex"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"EncodeToString"),n("span",{class:"token punctuation"},"("),s("mac"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Sum"),n("span",{class:"token punctuation"},"("),n("span",{class:"token boolean"},"nil"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"if"),s(" signature "),n("span",{class:"token operator"},"=="),s(" expectedSignature "),n("span",{class:"token punctuation"},"{"),s(`
        fmt`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Signature is valid."'),n("span",{class:"token punctuation"},")"),s(`
        fmt`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        fmt`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Println"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Signature is invalid."'),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token assign-left variable"},"api_secret"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},'"0285A2741D0E76E2E187260EB23E51851D48403A756333E7D0CF845406ABF3E8"'),s(`
`),n("span",{class:"token assign-left variable"},"timestamp"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$HTTP_TIMESTAMP"),s(`
`),n("span",{class:"token assign-left variable"},"signature"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},"$HTTP_SIGNATURE"),s(`
`),n("span",{class:"token assign-left variable"},"body"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token builtin class-name"},"echo"),s(" $HTTP_BODY "),n("span",{class:"token operator"},"|"),s(" jq "),n("span",{class:"token parameter variable"},"-S"),s(),n("span",{class:"token builtin class-name"},"."),n("span",{class:"token variable"},")")]),s("  "),n("span",{class:"token comment"},"# Requires jq to sort keys in json."),s(`

`),n("span",{class:"token assign-left variable"},"message"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${timestamp}"),s("&"),n("span",{class:"token variable"},"${body}"),s('"')]),s(`
`),n("span",{class:"token assign-left variable"},"expected_signature"),n("span",{class:"token operator"},"="),n("span",{class:"token variable"},[n("span",{class:"token variable"},"$("),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token parameter variable"},"-n"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${message}"),s('"')]),s(),n("span",{class:"token operator"},"|"),s(" openssl dgst "),n("span",{class:"token parameter variable"},"-sha256"),s(),n("span",{class:"token parameter variable"},"-hmac"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${api_secret}"),s('"')]),n("span",{class:"token variable"},")")]),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"["),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${signature}"),s('"')]),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${expected_signature}"),s('"')]),s(),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"then"),s(`
    `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},'"Signature is valid."'),s(`
    `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},[s('"'),n("span",{class:"token variable"},"${body}"),s('"')]),s(`
`),n("span",{class:"token keyword"},"else"),s(`
    `),n("span",{class:"token builtin class-name"},"echo"),s(),n("span",{class:"token string"},'"Signature is invalid."'),s(`
`),n("span",{class:"token keyword"},"fi"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function T(A,$){const c=o("ExternalLinkIcon"),l=o("RouterLink"),e=o("CodeGroupItem"),p=o("CodeGroup");return u(),k("div",null,[m,b,n("ul",null,[n("li",null,[s("1，在"),n("a",v,[s("我的"),a(c)]),s("设置中，设置默认的回调地址")]),g]),h,n("p",null,[s("服务器在发送回调消息时，会使用下单的API进行签名，接收方需验证签名后进行逻辑处理，否则可能会造成不必要的损失，服务器的签名过程和下单发起"),a(l,{to:"/zh/general/sign.html"},{default:t(()=>[s("签名")]),_:1}),s("的过程一致，接收方需要使用回调请求中的timestamp进行加密，并校验回调的"),y,s("是否一致")]),_,a(p,null,{default:t(()=>[a(e,{title:"Python",active:""},{default:t(()=>[f]),_:1}),a(e,{title:"Php"},{default:t(()=>[w]),_:1}),a(e,{title:"Java"},{default:t(()=>[S]),_:1}),a(e,{title:"Go"},{default:t(()=>[E]),_:1}),a(e,{title:"Shell"},{default:t(()=>[x]),_:1})]),_:1})])}const M=i(d,[["render",T],["__file","callback.html.vue"]]);export{M as default};
